# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack
Паттерн проектирования MVP

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание данных

### Перечисление Category

Описывает возможные категории товаров

### Интерфейс ICardItem

Описывает элементы карточки товара: Id, название, описание, изображение, категорию из типа Category, цену, текст кнопки карточки

### Интерфейс ICardList

Содержит массив карточек товаров и параметр общего кол-ва полученных карточек товара с сервера

### Интерфейс IOrderContacts

Форма заполнения данных о покупателе содержит телефон и почту покупателя

### Интерфейс IOrderPayments

Форма заполнения данных об оплате и доставке. Содержит способ оплаты товара и адрес доставки.

### Интерфейс IOrder

Содержит все данные по заказу, расширяет интерфейс IOrderContacts и IOrderPayments добавляя к нему данные об общей сумме покупки и массива строк Id купленных товаров

### Интерфейс IOrderResult

Описание ответа в случае успешной отправки заказа. Содержит ID заказа и общую сумму заказа

### Тип FormErrors

Содержит ошибки заполнения полей заказа, ключами являются данные из интерфейса IOrder, значения - строки.

### Класс Model

Модель данных получается в конструктор два элемента, объект данных и какие-то события, имеет метод emitChanges для оповещения о произошедшем событии, который принимает два аргумента, событие и объект данных

### Абстрактный класс Component

Принимает в конструктор HTML элемент container, имеет методы

- toggleClass, устанавливающий или удаляющий класс у HTML элемента, принимающий в качестве параметров HTML элемент, значение className, которое необходимо установить или удалить у HTML элемента, а также необязательный параметр force, указывающие на действие добавления или удаление класса.
- setText, принимающий HTML элемент и значение value, которые устанавливает значение value в textContent HTML элемента
- setImage, принимающий HTML элемент изображения, значение src, т.е. путь для изображения и опционально альт описание изображения и присваивающий элементу эти данные
- render добавляет в объект опционально передаваемые данные и возвращает DOM элемент container

### Интерфейс IEvents

Интерфейс IEvents имеет методы

- on для установки обработчика на событие,
- emit для инициализации события с данными,
- trigger, генерирует событие при вызове.

### Класс EventEmitter, реализовывающий интерфейс IEvents

Реализует методы on, emit, trigger интерфейса IEvents, а также имеет методы

- off для снятия обработчика с события
- onAll для установки слушателя на все события
- offAll для снятия всех обработчиков

### Класс Api

Реализовывает методы

- get для получения с сервера, принимающий параметр uri,
- post для отправки данных на сервер, принимающий uri ссылку, объект данных и метод запроса, а также метод handleResponse для обработки полученного ответа от сервера в методах get и post.
  Конструктор класса принимает базовый URL запроса, также опции запроса и присваивает их соответствующим параметрам объекта класса.

### Класс LarekApi, расширяет класс Api

Принимает в конструктор CDN URL и базовый URL, Имеет

- метод для получения массива объектов товаров, формирует URL для изображения из CDN URL и данных из объекта карточки из ключа "image".
- метод для отправки заказа на сервер

### Класс CardItem, расширяет класс Model

Создает объект с данными карточек товаров.

### Класс AppState, расширяет класс Model

Хранит данные о работе приложения (данные по заказу, каталогу товаров, ошибки форм, карточки для превью). Имеет методы:

- setOrderPayment. устанавливающий выбранный способ оплаты заказа
- setOrderAddress, устанавливающий значение адрес доставки заказа
- setCatalog, добавляет в каталог карточки товаров из полученного аргументом массива карточек
- setPreview устаналивает в параметре превью id выбранной карточки
- setButtonText меняет текст кнопки добавления карточки в корзину
- getCardsInOrder, возвращает массив карточек, добавленных в корзину
- getBasketItemIndex, возвращает индекс позиции карточки товара в корзине
- toggleCardOrder, добавляет товар в заказ или удаляет его в случае если он уже был добавлен
- deleteCardFromOrder удаляет товар из заказа
- clearBasket, очищает данные по заказу
- getTotal возвращает общую сумму товаров в заказе
- setOrderField устанавливает значения ключам заказа address, phone и email
- validateOrder выводит оповещение о не заполненных полях заказа

### Класс Card, расширяет абстрактный класс Component

Находит элементы темплейта карточки товара и присваивает соответствующим параметрам. Вешает обработчик клика на кнопку, в случае ее наличие, или на сам контейнер
Имеет сеттеры и геттеры для параметров Id, заголовка, описания, изображения, категории, цены товара, текст кнопки

### Класс BasketItem, расширяющий класс Card

Находит элементы темплейта карточки товара, находящегося в корзине и присваивает соответствующим параметрам.
Имеет сеттер для установки порядкового индекса товара в корзине

### Класс Page, расширяет абстрактный класс Component

Содержит элементы страницы - счетчик корзины, каталог товаров, корзину, обертку для блокировки прокрутки при открытии модального окна.
Имеет сеттеры для установки значения счетчика товаров в корзине, изменения содержания каталога товаров, блокировки прокрутки страницы

### Класс Form, расширяет абстрактный класс Component

Содерит данные о кнопке сабмита, и поля отображения ошибок валидации полей инпутов.
Конструктор класса находит в передаваемом контейнере HTML элементы кнопки сабмита и поля для отображения ошибок и вешает на них обработчики клика на кнопки и обработчик инпута на соответствующе поле.
Сдержит сеттеры valid для отключения кнопки сабмита при ошибках и errors для присвоения значения ошибки соответствующему HTML элементу.
Имеет методы

- onInputChange, создающий событие при изменении инпута и передающий с ним данные ключа и значения инпута
- render для отрисовки значение ошибок заполнения форм

### Класс OrderPayments, расширяет класс Form

Содержит данные о кнопках выбора способа оплаты, устанавливает на них обработчики клика. Содержит сеттер для установки значения полю адреса доставки заказа.
Имеет методы

- togglePayment для переключения класса нажатой кнопки
- cancelPayment для сброса состояние всех кнопок

### Класс OrderContacts, расширяет класс Form

Содержит сеттеры для установки значения телефона и электронной почты соответствующим полям ввода.

### Класс Modal, расширяет абстрактный класс Component

Имеет методы открытия и закрытия модального окна, сеттер для установки контента в модальное окно, метод рендер для отрисовки содержимого окна и его открытия.

### Класс Success, расширяет абстрактный класс Component

Содержит данные о HTML элементах - кнопка закрытия и описание.
Конструктор класса присваивает HTML элементы описания и кнопки закрытия соответствующим параметрам, вешает обработчик клика на кнопку закрытия окна.
Имеет сеттер total для установки полю с описанием значения суммы оформленного заказа

### Класс Basket, расширяет абстрактный класс Component

Содержит данные о блоке в который помещяются заказываемые товары, поля для отображ ения суммы всех товаров в корзине и кнопки для дальнейшего оформления заказа.
Конструктор класса присваивает значения HTML элементов соответствующим параметрам.

Сдержит сеттеры

- items для установки карточек товаров из получаемого массива в блок (list), либо случае отсутствия товаров в корзине, оповещает о том, что корзина пустая. Также управляет состоянием кнопки оформления заказа;
- total, устанавливает значение суммы товаров в корзине соответствующему полю

---

С сервера получаем массив карточек, по событию отрисовываем массив карточек в галерее, при клике на карточку по событию превью отрисовываем в модальном окне данные кликнутой карточки, открываем модальное окно. При нажатии на кнопку В корзину - товар добавляется, либо удаляется, если уже присутствует в ней. По клику вне окна или крестику окно закрывается. В корзине при оформлении заказа открывается модельное окна для выбора способа оплаты и указания ареса доставки товара. В случае если какой-то из параметров не заполнен, блокируется переход к следующему действию. Далее заполняются поля для указания почты и телефона, в случае отсутствия ошибок при переходе далее заказ отправляется на сервер. В случае успешной отправки появляется модальное окна с оповещением об успешном заказе и сумме покупки, также очищается корзина.
